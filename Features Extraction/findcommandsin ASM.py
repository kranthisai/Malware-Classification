#uniqueCommands =[]

def vocabHist(filename,vocab):
    fileName =  'G:/project/train/'+filename+'.asm'
    fileHandle = open(fileName, 'r')
    commandList=[]
    for line in fileHandle:
        parts = line.split()
        for part in parts:
            if part.isalpha() and part.islower():
                try:
                    #print part
                    commandList.append(part)
                    break
                except ValueError:
                    break

    #print len(commandList)
    #commandList = set(commandList)
    #commandList = list(commandList)
    for item in commandList:
        if item in vocab:
            vocab[item] += 1
        
    
    
    #print vocab
    return vocab
    
def main():
    fileNames = open('D:/ASU-CS-Course/Machine learning/ML Project/project/ASMfeatures/trainLabels.csv','r')
    vocabFile = open('D:/ASU-CS-Course/Machine learning/ML Project/project/ASMfeatures/commandVocab.txt','r')
    writeFile = open('C:/Users/Abhi/workspace/MalwareClassification/ASMTRAINFULLDATA.csv','w')
    writeFile.write('Id'+','+'class'+',')
    
    allcommands = []
    for item in vocabFile.readlines():
        allcommands.append(item.split(','))
    #print len(allcommands[0])
    allcommands=allcommands[0][0:-1]
    #print allcommands
    #allcommands =sorted(allcommands)
    vocab1={}
    count = 0
    for ins in allcommands:
        count += 1 
        vocab1[ins]=0
        writeFile.write(str(count)+',')
    print len(vocab1.keys())
    writeFile.write('\n')
    writeFile.write(''+','+''+',')
    for item in sorted(vocab1.keys()):
        writeFile.write(item+',')

    writeFile.write('\n')
    
    filename = ""
    
    #count = 0
    for line in fileNames:
        try:
            classtype = int(line.split(",")[1])         
            filename = line.split(",")[0][1:-1]
            #print type(classtype) == int, len(filename)
            path = 'G:/project/train/'+filename+'.asm'
            try:
                asd = open(path,'r')
                vocab = {}
                for inst in allcommands:
                    vocab[inst]=0
                #print 'true'
                hist = vocabHist(filename,vocab)
                #print hist
                #nConstant = float(sum(hist.values()))
                #print nConstant
                writeFile.write(filename+','+str(classtype)+',')
                #count = count +1
                #print filename
                #print len(filename)
                #break
                for item in sorted(hist.keys()):
                    writeFile.write(str(hist[item])+',')
                writeFile.write('\n')
            except IOError:
                pass

        except ValueError:
            print line
        
    #print count'''
    #writeFile.write("nothing"+','+"sfgjdsgf")
            
    #hist = vocabHist("0A32eTdBKayjCWhZqDOQ",vocab)
    #nConstant = float(sum(hist.values()))
    #writeFile.write("0A32eTdBKayjCWhZqDOQ"+','+str(0.3)+',')
    #for item in sorted(hist.keys()):
    #    writeFile.write(str(hist[item]/nConstant)+',')
    #writeFile.write('\n')
    #print vocabHist("0ACDbR5M3ZhBJajygTuf",vocab)


if __name__ == "__main__":
    main()

from fileinput import filename

def vocabHist(filename,vocab):
    fileName =  'G:/project/test/'+filename+'.asm'
    fileHandle = open(fileName, 'r')
    commandList=[]
    for line in fileHandle:
        parts = line.split()
        for part in parts:
            if part[len(part)-4:]=='.dll':
                    #print part
                    commandList.append(part)

    #print len(commandList)
    #commandList = set(commandList)
    #commandList = list(commandList)
    for item in commandList:
        if item in vocab:
            vocab[item] += 1
        
    
    
    #print vocab
    return vocab
    
def main():
    fileNames = open('C:/Users/Abhi/workspace/MalwareClassification/sampleSubmission.csv', 'r')
    vocabFile = open('C:/Users/Abhi/workspace/MalwareClassification/ALLDLL.txt', 'r')
    writeFile = open('C:/Users/Abhi/workspace/MalwareClassification/ASMDLLTESTFEATURES.csv', 'w')
    writeFile.write('Id'+',')
    
    allDLLS = []
    for item in vocabFile.readlines():
        allDLLS.append(item.split(','))
    
    #print len(allcommands[0])
    
    allDLLS= allDLLS[0][0:-1]
    #print len(allDLLS)
    #allcommands =sorted(allcommands)
    vocab1={}
    count = 0
    for ins in allDLLS:
        count += 1 
        vocab1[ins]=0
        writeFile.write(str(count)+',')
    #print len(vocab.keys())
    writeFile.write('\n')
    #writeFile.write(''+',')
    #for item in sorted(vocab1.keys()):
    #    writeFile.write(item+',')

    #writeFile.write('\n')
    
    filename = ""
    
    count = 0
    for line in fileNames:
        try:
            #classtype = int(line.split(",")[1])         
            filename = line.split(",")[0][1:-1]
            #print filename
            if len(filename) ==20:
                count += 1
                print count
                path = 'G:/project/test/'+filename+'.asm'
                try:
                    asd = open(path,'r')
                    #print 'true'
                    vocab ={}
                    for inst in allDLLS:
                        vocab[inst] = 0
                    hist = vocabHist(filename,vocab)
                    #print hist
                    #nConstant = float(sum(hist.values()))
                    #print nConstant
                    writeFile.write(filename+',')
                    #count = count +1
                    #print filename
                    #print len(filename)
                    #break
                    for item in sorted(hist.keys()):
                        writeFile.write(str(hist[item])+',')
                    writeFile.write('\n')
                except IOError:
                    print filename
                
        except ValueError:
            print line
            #pass
            
        
    #print count'''
    #writeFile.write("nothing"+','+"sfgjdsgf")
            
    #hist = vocabHist("0A32eTdBKayjCWhZqDOQ",vocab)
    #nConstant = float(sum(hist.values()))
    #writeFile.write("0A32eTdBKayjCWhZqDOQ"+','+str(0.3)+',')
    #for item in sorted(hist.keys()):
    #    writeFile.write(str(hist[item]/nConstant)+',')
    #writeFile.write('\n')
    #print vocabHist("0ACDbR5M3ZhBJajygTuf",vocab)


if __name__ == "__main__":
    main()

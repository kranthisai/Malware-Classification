import numpy as np
import neurolab as nl
import math

def main():  
    featureFile = open('C:/Users/Abhi/workspace/MalwareClassification/trainASM42.csv', 'r')
    labelsFile = open('C:/Users/Abhi/workspace/MalwareClassification/trainLabels.csv', 'r')
    outputFile = open('C:/Users/Abhi/workspace/MalwareClassification/asmFeatures.csv', 'w')
    for i in range(41):
        outputFile.write('feature'+str(i)+',')
    outputFile.write('Id'+','+'class'+'\n')
    inp = featureFile.readlines()
    classLabels = labelsFile.readlines()
    classLabels = classLabels[1:]
    for i in range(len(classLabels)):
        classLabels[i] = classLabels[i].split(",") 
    #print len(classLabels[0][0][1:-1])
    #print classLabels[0] , classLabels[0][1][:-1]
    
    #inp = inp[0:-2]
    #print inp[29]
    inp1=[]
    out=[]
    for line in inp:
        inp1.append(line.split(","))
    for i in range(len(inp1)):
            inp1[i][len(inp1[0])-1]=inp1[i][len(inp1[0])-1][:-2]
    
    #print len(inp1), len(inp1[0]),len(inp1[0][len(inp1[0])-1]) 
    '''for item in classLabels:
        print len(item[0][1:-1])
        break'''
    count = 0        
    for i in range(len(inp1)):
        for j in range(len(classLabels)):
            if inp1[i][len(inp1[i])-1] == classLabels[j][0][1:-1]:
                count += 1 
                print count
                inp1[i].append(classLabels[j][1][:-1])
                
                    
    for i in range(len(inp1)):
        for j in range(len(inp1[0])):
            outputFile.write(inp1[i][j]+',')
        outputFile.write('\n')    
    print inp1[0]
                
                
    #print len(inp1[10867][len(inp1[0])-1])'''    
    '''for i in range(len(inp1)):
        out[i] = float(out[i][0])
        for j in range (len(inp1[0])):
            inp1[i][j] = float(inp1[i][j])
    inp2 = np.array(inp1)
    out2 = np.array(out)
    tar = out2.reshape(len(out2),1)
    #print len(inp2)
    #print len(tar)
    #okCount=0
    #notokCount=0'''
    '''for item in inp2:
        if sum(item)> 0.99:
            okCount += 1
        else:
             notokCount +=1
    print okCount
    print notokCount'''

    '''inp3 = [list(i) for i in zip(*inp1)]
    neuinp=[]
    for item in inp3:
        neuinp.append([-0.5,0.5])
    #print neuinp

    net = nl.net.newff(neuinp,[5,1])
    print net.ci
    print net.co
    print len(net.layers)
    error = net.train(inp2,tar,show=100,goal=0.01)
    #net.save('classify.net')
    #newnet = nl.load('classify.net')
    print "fine"
    print net.sim(inp2)
    #ans=[]
    #for item in inp2:
    #    ans.append(net.sim([item]))
    #print ans[0][0]
    #print ans
    #calculateError(ans,out)
    #print ans[0][0]'''

def calculateError(simoutput,output):
    err = 0
    for i in range(len(simoutput)):
        err += math.pow((simoutput[i][0]- output[i][0]),2)
    err = err/len(simoutput)
    print err
if __name__ == "__main__":
    main()

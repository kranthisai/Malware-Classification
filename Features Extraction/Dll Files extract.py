'''
Created on 08-Apr-2015

@author: Kranti
'''
from sklearn.ensemble import RandomForestClassifier
import numpy as np
import cPickle
#uniqueCommands =[]

    
def main():
    file = open('D:/ASU-CS-Course/Machine learning/ML Project/project/ASMfeatures/trainLabels.csv','r')
    fileNames = file.readlines() 
    vocab={}
    allDLLS = []
    #vocabFile = open('D:/ASU-CS-Course/Machine learning/ML Project/project/ASMfeatures/commandVocab.txt','r')
    writeFile = open('C:/Users/Abhi/workspace/MalwareClassification/ALLDLL.txt', 'w')
    #writeFile.write('Id'+','+'Class'+',')
    #fileNames=fileNames[1:]
    for line in fileNames:
        try:
            classtype = int(line.split(",")[1])         
            filename = line.split(",")[0][1:-1]
            #print len(filename), type(classtype)
            path = 'G:/project/train/'+filename+'.asm'
            try:
                f=open(path,'r')
                for item in f:
                    parts=item.split()
                    for part in parts:                                        
                        if part[len(part)-4:]=='.dll':
                            if part not in allDLLS:
                                allDLLS.append(part)
                                #vocab[part1]=0
                                '''else:
                                allcommands.append(part)
                                vocab[part]=vocab[part]+1'''
            except IOError:
                pass
        except ValueError:
            print line
        print len(allDLLS)
    #print allDLLS
    for item in allDLLS:
        writeFile.write(item+',') 
    
    '''for key in vocab.keys():
      
        writeFile.write(key+',')'''
    
    
    #writefile = open('H:/MainProject/dataSample/fulldatatotrain4.csv','w')
    '''fileNames = open('H:/trainLabels.csv','r')
    
    #writeFile.write('\n')
    
    for line in fileNames:
        vocab1={}
        writeFile.write('\n')
        try:
            classtype = int(line.split(",")[1])         
            filename = line.split(",")[0][1:-1]
            writeFile.write(filename+','+str(classtype)+',')
            path = 'H:/MainProject/train/train/'+filename+'.asm'
            try:
                f=open(path,'r')
                for item in f:
                    parts=item.split()
                    for part in parts:                                        
                        if '.dll' in part:
                            sep=','
                            part1=part.split(sep,1)[0]
                            vocab1[part1]=0
                            for key in vocab.keys():
                                if part1 == key:
                                    
                                    vocab1[key]=vocab1[part1]+1
                                else:
                                    vocab1[key]=0
     '''                       '''else:
                                allcommands.append(part)
                                vocab[part]=vocab[part]+1'''
    '''        except IOError:
                pass
        except ValueError:
            pass
        for value in vocab1.values():
            writeFile.write(str(value)+',') 
    '''    
        
    
    '''
    for line1 in fileNames:
        value1={}
        try:
            classtype = int(line1.split(",")[1])         
            filename = line1.split(",")[0][1:-1]
            #print filename
            writeFile.write('\n')
            writeFile.write(filename+','+classtype+',')
            path = 'H:/MainProject/sampletrainasm/'+filename+'.asm'
            try:
                f=open(path,'r')
                for item in f:
                    parts1=item.split()
                    for part in parts1:
                        if '.dll'  in part:
                            sep=','
                            part2=part.split(sep,1)[0]
                            value1[key]=0;
                            for key in vocab.keys():
                                if part2 in key:
                                    value1[key]=value1[key]+1 
                                    #vocab[key]=vocab[key]+1
                                else:
                                    value1[key]=0
                                    #vocab[key]=0
        
                                    
            except IOError:
                pass
        except ValueError:
            pass  
        for value in value1.values()():
            writeFile.write(value+',')                  
                                
                   
           
   
 

    '''
if __name__ == "__main__":
    main()
